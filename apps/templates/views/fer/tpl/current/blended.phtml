<?php
$view->getMetaView()->_tpl_version = '1.0';//Defining this template version

$isRO = (!empty($_REQUEST['report_mode']) && strtolower($_REQUEST['report_mode'])==='r');//Is it on read only mode?

$LvlScale = $ReportContent = array();//Declare some useful array

$LP = !empty($view->RpData)	? $view->RpData	: null;//Set full data

if (empty($LP['success']))
	echo $view->getBlock('blocks/fer/throwError', array('Data'=>$LP));//Display error block
elseif (isset($LP['learning_plan_final_evaluation']) && is_array($LP['learning_plan_final_evaluation'])){
	foreach ($LP['learning_plan_final_evaluation'] as $reportField){
		if (!empty($reportField['id']))
			$ReportContent[$reportField['id']] = $reportField;//Fill in the array that contains the custom fields for the report
	}
}
$User = !empty($LP['user_profile']) ? $LP['user_profile'] : null;
if (!empty($LP['level_scale'])){
	foreach ($LP['level_scale'] as $i=>$lvl)
		$LvlScale[$lvl['id']] = $lvl['name'];
}
# Temporary : set all acquired and recommended levels in hard code taken from the LMS due to data missing from ETime
$acquiredLevels = array(
	1117 => 'A1.1',
	1118 => 'A1.2',
	1119 => 'A1.3',
	1120 => 'A1.4',
	1121 => 'A2.1',
	1122 => 'A2.2',
	1123 => 'A2.3',
	1124 => 'A2.4',
	1125 => 'A2.5',
	1126 => 'A2.6',
	1127 => 'B1.1',
	1128 => 'B1.2',
	1129 => 'B1.3',
	1130 => 'B1.4',
	1131 => 'B1.5',
	1132 => 'B1.6',
	1133 => 'B2.1',
	1134 => 'B2.2',
	1135 => 'B2.3',
	1136 => 'B2.4',
	1137 => 'B2.5',
	1138 => 'B2.6',
	1139 => 'C1.1',
	1140 => 'C1.2',
	1141 => 'C1.3',
	1142 => 'C1.4',
	1143 => 'C2',
);
$recommendedLevels = array(
	1322 => 'A1.1',
	1323 => 'A1.2',
	1324 => 'A1.3',
	1325 => 'A1.4',
	1326 => 'A2.1',
	1327 => 'A2.2',
	1328 => 'A2.3',
	1329 => 'A2.4',
	1330 => 'A2.5',
	1331 => 'A2.6',
	1332 => 'B1.1',
	1333 => 'B1.2',
	1334 => 'B1.3',
	1335 => 'B1.4',
	1336 => 'B1.5',
	1337 => 'B1.6',
	1338 => 'B2.1',
	1339 => 'B2.2',
	1340 => 'B2.3',
	1341 => 'B2.4',
	1342 => 'B2.5',
	1343 => 'B2.6',
	1344 => 'C1.1',
	1345 => 'C1.2',
	1346 => 'C1.3',
	1347 => 'C1.4',
	1348 => 'C2',
);
if (empty($LvlScale)) $LvlScale = $recommendedLevels;
$levelSelectors = $LvlScale;
if (count($levelSelectors)<count($recommendedLevels))
	$levelSelectors = $recommendedLevels;

/**
 * Unfortunately, we need to set all the CSS inline. Using a PHP hack
 */
$style = array(
	'#report_container'		=>'background: white; text-align: left; padding: 20px 0; font-family: Arial; font-size: 13px;',
	'#report_subcontainer'	=>'margin: auto; width: 98%; font-family: Arial;',
	'#evaluator_comments'	=>'width: 100%; min-width: 100%; max-width: 100%; height: 120px; border: 1px solid rgb(225,225,225); background: white; padding: 10px; font-family: Arial;',
	'.paragraph-title'		=>'text-transform: uppercase; margin: 15px 0; font-weight: normal; font-size: 16px; font-family: Arial;',
	'.paragraph-subtitle'	=>'font-size: 14px; text-transform: uppercase; margin: 10px 0; font-weight: normal; font-family: Arial;',
	'.profile-block'		=>'padding: 2.5%; width: 95%; margin: auto; font-family: Arial;',
	'table'					=>'border-collapse: collapse; width: 100%; font-family: Arial;',
	'td'					=>'padding: 10px 5px; font-size: 13px; font-family: Arial;',
	'.profile-block td'		=>'padding: 15px 0;',
	'.top-bar'				=>'border-top: 1px solid rgb(118,118,118);',
	'.top-bar-lightgrey'	=>'border-top: 1px solid lightgrey;',
	'.left-bar'				=>'border-left: 1px solid rgb(118,118,118);',
	'.left-bar-lightgrey'	=>'border-left: 1px solid lightgrey;',
	'.profile-block .left-bar'=>'font-family: Arial;text-align: center;',
	'.profile-label'		=>'text-transform: uppercase; font-size: 13px;',
	'.profile-value'		=>'font-weight: bold; font-family: Arial; font-size: 12px;',
	'.bg-grey'				=>'background: rgb(233,233,233); font-family: Arial;',
	'.table-total-label'	=>'text-align: right; text-transform: uppercase; padding-right: 25px; font-family: Arial;',
	'.level-scale-container'=>'width: 95%; margin: auto; font-family: Arial;',
	'.level-spacing'		=>'margin: 15px;',
	'.level-label'			=>'display: inline-block; width: 29%; font-size: 13px; text-transform: uppercase; font-family: Arial;',
	'.level-scale'			=>'display: inline-block; width: 70%; height: 30px; background: white; border: none; padding-left: 20px; font-family: Arial;',
	'.radio-label'			=>'font-size: 13px; cursor: pointer; font-family: Arial;',
	'.lpadding-20'			=>'padding-left:20px;',
	'.lpadding-40'			=>'padding-left:40px;',
);?>
<div id="report_container" style="<?php echo $style['#report_container']?>">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="423.000000pt" height="119.000000pt" viewBox="0 0 423.000000 119.000000"
 preserveAspectRatio="xMidYMid meet">
<g transform="translate(0.000000,119.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M1328 1177 c-97 -28 -157 -104 -158 -200 0 -57 28 -117 67 -145 25
-18 158 -63 271 -92 51 -13 77 -46 67 -89 -13 -60 -82 -88 -171 -70 -59 11
-94 42 -109 97 l-11 37 -69 0 -70 0 3 -45 c9 -143 133 -228 318 -218 163 9
259 91 259 223 0 50 -5 69 -27 103 -39 58 -63 71 -210 113 -138 39 -168 57
-168 98 0 50 34 71 110 71 71 0 106 -21 121 -70 l12 -40 69 0 c79 0 87 8 68
67 -34 108 -113 163 -244 169 -49 2 -100 -1 -128 -9z"/>
<path d="M3651 1166 c-9 -11 -11 -86 -9 -278 3 -249 4 -265 25 -305 48 -88
138 -133 268 -133 130 0 220 45 268 133 21 40 22 56 25 307 3 243 2 265 -14
277 -22 16 -106 17 -122 1 -9 -9 -12 -79 -12 -255 0 -266 -4 -285 -56 -313
-35 -19 -143 -19 -178 0 -52 28 -56 47 -56 314 0 232 -1 246 -19 256 -29 15
-107 12 -120 -4z"/>
<path d="M0 1161 c0 -6 56 -101 125 -213 l125 -202 0 -126 c0 -158 2 -162 90
-158 l65 3 3 138 3 138 124 200 c69 111 125 207 125 215 0 11 -18 14 -79 14
l-79 0 -83 -140 c-50 -83 -87 -136 -92 -131 -5 5 -44 67 -86 138 l-76 128 -82
3 c-51 2 -83 -1 -83 -7z"/>
<path d="M671 1102 l-41 -68 0 -275 c0 -201 3 -278 12 -287 17 -17 489 -17
506 0 15 15 16 82 2 109 -10 18 -23 19 -190 19 l-180 0 0 79 c0 63 3 80 16 85
9 3 85 6 170 6 l154 0 0 60 0 60 -167 2 -168 3 0 70 0 70 174 3 c112 2 179 7
188 14 9 7 13 28 11 62 l-3 51 -222 3 -222 2 -40 -68z"/>
<path d="M1792 1161 c37 -3 71 -10 76 -16 5 -5 78 -110 162 -232 84 -123 159
-223 166 -223 12 0 14 42 14 234 l0 235 33 4 c31 4 31 4 -5 5 l-38 2 0 -230
c0 -126 -3 -230 -7 -230 -5 0 -73 96 -153 212 -80 117 -153 220 -162 230 -14
14 -32 18 -85 16 l-68 -1 67 -6z"/>
<path d="M2350 1157 c0 -7 56 -104 125 -215 l124 -201 3 -138 3 -138 69 -3
c49 -2 72 1 77 10 5 7 9 72 9 143 l0 131 125 201 c69 111 125 206 125 213 0 7
-27 10 -82 8 l-82 -3 -77 -129 c-43 -70 -81 -132 -86 -137 -5 -5 -44 51 -92
131 l-82 140 -80 0 c-59 0 -79 -3 -79 -13z"/>
<path d="M3132 1152 c-76 -27 -122 -69 -162 -146 -30 -59 -35 -78 -38 -161 -6
-135 20 -218 92 -290 67 -67 129 -90 246 -90 153 0 242 51 302 173 31 63 33
72 33 177 0 91 -4 120 -23 167 -28 68 -87 133 -150 161 -67 30 -226 35 -300 9z
m239 -137 c98 -64 116 -266 32 -366 -69 -81 -197 -80 -269 3 -76 86 -68 277
14 351 56 51 156 56 223 12z"/>
<path d="M2340 760 l-5 -285 -76 -3 -77 -3 -169 233 c-93 128 -174 232 -179
231 -5 -2 -11 -81 -14 -175 -5 -187 -13 -215 -66 -257 -16 -13 -21 -21 -12
-21 16 0 49 33 69 70 10 17 16 78 19 199 l5 175 167 -231 c110 -151 176 -233
190 -237 40 -10 123 -7 141 7 16 11 17 38 15 297 l-3 285 -5 -285z"/>
<path d="M669 166 c-17 -8 -24 -20 -24 -41 0 -26 5 -31 45 -45 33 -11 45 -21
45 -35 0 -31 -58 -33 -79 -4 -18 26 -36 17 -20 -9 18 -29 61 -39 92 -21 52 29
38 71 -29 89 -41 11 -54 42 -23 54 25 10 32 7 54 -16 20 -22 20 -22 20 -1 0
28 -48 46 -81 29z"/>
<path d="M3883 172 c-32 -5 -53 -40 -53 -87 0 -58 18 -79 66 -77 88 3 84 1 84
43 l0 39 -42 -1 c-39 -1 -40 -2 -13 -8 30 -7 34 -23 13 -48 -14 -18 -53 -16
-72 3 -25 24 -21 90 6 108 30 21 44 20 69 -5 23 -23 33 -21 23 4 -7 19 -50 34
-81 29z"/>
<path d="M250 90 c0 -64 3 -80 15 -80 12 0 15 16 15 80 0 64 -3 80 -15 80 -12
0 -15 -16 -15 -80z"/>
<path d="M390 90 c0 -94 18 -108 22 -18 l3 63 40 -63 c54 -84 65 -81 65 18 0
47 -4 80 -10 80 -6 0 -10 -29 -10 -67 l0 -68 -41 68 c-55 92 -69 89 -69 -13z"/>
<path d="M870 90 c0 -78 16 -112 22 -47 3 30 6 32 47 37 45 5 65 27 53 60 -9
24 -24 30 -74 30 l-48 0 0 -80z m100 35 c0 -18 -7 -26 -25 -31 -36 -9 -55 2
-55 31 0 23 4 25 40 25 36 0 40 -3 40 -25z"/>
<path d="M1110 90 c0 -47 4 -80 10 -80 6 0 10 33 10 80 0 47 -4 80 -10 80 -6
0 -10 -33 -10 -80z"/>
<path d="M1250 90 c0 -47 4 -80 10 -80 6 0 10 16 10 36 0 35 1 35 38 32 34 -3
37 -6 40 -35 2 -19 9 -33 16 -33 10 0 11 10 5 43 -4 24 -4 46 2 52 30 30 -8
65 -72 65 l-49 0 0 -80z m104 45 c8 -21 -21 -45 -55 -45 -26 0 -29 3 -29 30 0
28 2 30 39 30 25 0 41 -5 45 -15z"/>
<path d="M1500 90 c0 -47 4 -80 10 -80 6 0 10 33 10 80 0 47 -4 80 -10 80 -6
0 -10 -33 -10 -80z"/>
<path d="M1630 90 c0 -94 18 -108 22 -18 l3 63 40 -62 c54 -85 65 -82 65 17 0
94 -18 108 -22 18 l-3 -62 -38 62 c-53 86 -67 83 -67 -18z"/>
<path d="M1894 149 c-13 -14 -19 -36 -19 -66 0 -57 32 -88 80 -78 16 3 38 7
48 8 13 1 17 10 17 39 0 37 -1 38 -37 37 -31 -2 -33 -3 -10 -6 29 -5 37 -29
15 -51 -17 -17 -63 -15 -79 4 -19 23 -16 80 6 104 23 26 43 25 72 -2 28 -26
43 -16 18 12 -25 28 -86 27 -111 -1z"/>
<path d="M2280 90 l0 -80 53 2 c50 1 50 2 10 5 l-43 4 0 75 c0 43 -4 74 -10
74 -6 0 -10 -33 -10 -80z"/>
<path d="M2490 90 l0 -80 63 2 62 2 -52 3 c-51 4 -53 5 -53 34 0 28 2 29 45
29 25 0 45 5 45 10 0 6 -20 10 -45 10 -41 0 -45 2 -45 25 0 23 3 25 50 25 28
0 50 5 50 10 0 6 -27 10 -60 10 l-60 0 0 -80z"/>
<path d="M2766 162 c-5 -9 -56 -142 -56 -148 0 -14 19 0 28 21 16 35 69 35 82
0 5 -14 15 -25 21 -25 6 0 8 7 4 18 -3 9 -16 45 -28 80 -20 56 -38 75 -51 54z
m28 -44 c10 -39 7 -48 -18 -48 -23 0 -24 2 -13 35 12 40 22 44 31 13z"/>
<path d="M2960 90 c0 -47 4 -80 10 -80 6 0 10 16 10 35 0 30 3 35 24 35 42 0
56 -11 56 -41 0 -16 4 -29 9 -29 14 0 11 143 -3 152 -6 4 -32 8 -58 8 l-48 0
0 -80z m100 36 c0 -25 -16 -36 -56 -36 -20 0 -24 5 -24 30 0 28 2 30 40 30 36
0 40 -3 40 -24z"/>
<path d="M3200 90 c0 -94 18 -108 22 -18 l3 62 38 -62 c53 -86 67 -83 67 18 0
47 -4 80 -10 80 -6 0 -10 -29 -10 -67 l0 -68 -43 68 c-23 37 -47 67 -54 67 -9
0 -13 -22 -13 -80z"/>
<path d="M3450 90 c0 -47 4 -80 10 -80 6 0 10 33 10 80 0 47 -4 80 -10 80 -6
0 -10 -33 -10 -80z"/>
<path d="M3590 90 c0 -47 4 -80 10 -80 6 0 10 28 10 63 l0 62 40 -62 c55 -88
70 -84 70 17 0 97 -18 107 -22 13 l-3 -68 -40 67 c-22 37 -46 68 -52 68 -9 0
-13 -23 -13 -80z"/>
</g>
</svg>
	
	<div id="report_subcontainer" style="<?php echo $style['#report_subcontainer']?>">
		<h1 class="paragraph-title" style="<?php echo $style['.paragraph-title']?>">
			PROFILE
		</h1>
		<div style="<?php echo $style['.profile-block']?>">
			<table style="<?php echo $style['table']?>">
				<tr>
					<td class="profile-label" style="<?php echo $style['td'].$style['.profile-label']?>">LEARNER:</td>
					<td class="profile-value" style="<?php echo $style['td'].$style['.profile-value']?>">
						<?php echo !empty($User['firstname']) ? $User['firstname'].'&nbsp;' : '';?>
						<?php echo !empty($User['lastname']) ? $User['lastname'] : '';?>
					</td>
					<td colspan="4">
						<span class="profile-label" style="<?php echo $style['td'].$style['.profile-label']?>">Title:</span>
						&nbsp;&nbsp;&nbsp;
						<span class="profile-value" style="<?php echo $style['td'].$style['.profile-value']?>"><?php
						if (!empty($LP['learning_plan']['path_name']))
							echo _('Final Report for').' '.$LP['learning_plan']['path_name'];?></span>
					</td>
				</tr>
				<tr>
					<td class="profile-label" style="<?php echo $style['td'].$style['.profile-label']?>">Company:</td>
					<td class="profile-value" style="<?php echo $style['td'].$style['.profile-value']?>"><?php
					if (!empty($User['fields']) && is_array($User['fields'])){
						foreach ($User['fields'] as $i=>$field){
							if (!empty($field['name']) && !empty($field['value']) && strtolower($field['name'])==='company name'){
								echo $field['value'];
								break;
							}
						}
					}?></td>
					<td class="profile-label" style="<?php echo $style['td'].$style['.profile-label']?>">Start date:</td>
					<td class="profile-value" style="<?php echo $style['td'].$style['.profile-value']?>"><?php
						$date_begin = !empty($LP['learning_plan_user_details']['date_assign']) ? $LP['learning_plan_user_details']['date_assign'] :
							(!empty($LP['learning_plan_user_details']['date_begin_validity']) ? $LP['learning_plan_user_details']['date_begin_validity'] : null);
						echo $date_begin ? date('d.m.Y', strtotime($date_begin)) : '&nbsp;';?></td>
					<td class="profile-label" style="<?php echo $style['td'].$style['.profile-label']?>"><?php echo _('End date:')?></td>
					<td class="profile-value" style="<?php echo $style['td'].$style['.profile-value']?>"><?php
						$date_end = !empty($LP['learning_plan_user_details']['course_completed']) ? $LP['learning_plan_user_details']['course_completed'] :
							(!empty($LP['learning_plan_user_details']['date_end_validity']) ? $LP['learning_plan_user_details']['date_end_validity'] : null);
						echo $date_end ? date('d.m.Y', strtotime($date_end)) : '&nbsp;';?></td>
				</tr>
				<tr>
					<td class="profile-label" style="<?php echo $style['td'].$style['.profile-label']?>">Date:</td>
					<td class="profile-value" style="<?php echo $style['td'].$style['.profile-value']?>"><?php echo date('d.m.Y')?></td>
					<td class="profile-label" style="<?php echo $style['td'].$style['.profile-label']?>">Total time:</td>
					<td class="profile-value" style="<?php echo $style['td'].$style['.profile-value']?>"><?php
						//Should be in seconds
						#First, totaltime is only elearning
						$totaltime = !empty($LP['learning_plan_user_details']['time_spent']) ? (int)$LP['learning_plan_user_details']['time_spent'] : 0;
						#calculate session time
						if (!empty($LP['learning_plan_courses'])){
							foreach ($LP['learning_plan_courses'] as $ix=>$LPC){
								if (empty($LPC['course_info']['course_name']) ||
									!in_array(strtolower($LPC['course_info']['course_type']), array('videoconference', 'classroom', 'webinar', 'telephone')))
								{
									continue;
								}
								$session = !empty($LPC['course_sessions'][0]['session_info']) ? $LPC['course_sessions'][0] : null;
								if (!$session)
									continue;
								$duration = 0;
								if (!empty($session['user_session_details']['evaluation_score'])){
									if (!empty($session['user_session_details']['attendance_hours'])){
										$duration = (float)$session['user_session_details']['attendance_hours']*3600;
									}
									elseif (!empty($session['session_info']['date_end'])){
										$t_begin	= strtotime($session['session_info']['date_begin']);
										$t_end		= strtotime($session['session_info']['date_end']);
										$duration	= $t_end - $t_begin;
									}
								}
								$totaltime+=$duration;
							}
						}
						if ($totaltime){
							echo gmdate('H:i', $totaltime);
						}?></td>
				</tr>
			</table>
		</div>
		
		<br><br><br><br>
		
		<h1 class="paragraph-title" style="<?php echo $style['.paragraph-title']?>">
			All courses in the learning plan
		</h1>
		<div class="profile-block" style="<?php echo $style['.profile-block']?>">
			<h2 class="paragraph-subtitle" style="<?php echo $style['.paragraph-subtitle']?>">E-learning results:</h2>
			<table style="<?php echo $style['table']?>">
				<tr>
					<td style="<?php echo $style['td'].$style['.profile-block td']?>width:64%;"></td>
					<td class="profile-value left-bar" style="<?php echo $style['td'].$style['.profile-value'].
						$style['.left-bar'].$style['.profile-block .left-bar']?>width:18%;">Assessment</td>
					<td class="profile-value left-bar" style="<?php echo $style['td'].$style['.profile-value'].
						$style['.left-bar'].$style['.profile-block .left-bar']?>width:18%;">Time</td>
				</tr>
				<?php
				$totalPercentage = $totalTimeSpent = $nbCourses = $nbAttendances = 0;
				if (!empty($LP['learning_plan_courses'])){
					foreach ($LP['learning_plan_courses'] as $ix=>$LPC){
						if (empty($LPC['course_info']['course_name'])||
							strtolower($LPC['course_info']['course_type'])!=='elearning') continue;
						$nbCourses++;
						if (isset($LPC['course_user_details']['status']) && $LPC['course_user_details']['status']==2) $nbAttendances++;?>
				<tr>
					<td class="top-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.top-bar']?>"><b><?php echo $LPC['course_info']['course_name'];?></b><?php
						echo !empty($LPC['course_user_details']['date_completed']) ? ' - '.date('d.m.Y H:i', strtotime($LPC['course_user_details']['date_completed'])) : ''; ?></td>
					<td class="left-bar top-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].
						$style['.top-bar'].$style['.profile-block .left-bar']?>"><?php
						$score = !empty($LPC['course_user_details']['score_given']) ? (float)$LPC['course_user_details']['score_given'] : 0;
						$totalPercentage += $score;
						echo $score ? number_format($score, 2, ',', '.').'%' : ' - ';
					?></td>
					<td class="left-bar top-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].$style['.top-bar'].$style['.profile-block .left-bar']?>"><?php
						//Time spent
						if (!empty($LPC['course_user_details']['time_spent'])){
							$timespent = (float)$LPC['course_user_details']['time_spent'];
							$totalTimeSpent += $timespent;
							echo gmdate('H:i', $timespent);
						}
						else echo ' - ';
						?></td>
				</tr><?php
					}
				}?>
				<tr class="bg-grey" style="<?php echo $style['.bg-grey']?>">
					<td class="table-total-label" style="<?php echo $style['td'].$style['.profile-block td'].$style['.table-total-label']?>"><?php echo _('Total e-learning average')?></td>
					<td class="profile-value left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].
						$style['.profile-value'].$style['.profile-block .left-bar']?>"><?php if ($nbCourses) echo number_format(($totalPercentage/$nbAttendances), 2, ',', '.').'%';?></td>
					<td class="profile-value left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].
						$style['.profile-value'].$style['.profile-block .left-bar']?>"><?php echo $totalTimeSpent ? gmdate('H:i', $totalTimeSpent) : ' - ';?></td>
				</tr>
				<tr>
					<td class="table-total-label" style="<?php echo $style['td'].$style['.profile-block td'].$style['.table-total-label']?>"><?php echo _('Attendance')?></td>
					<td class="left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].$style['.profile-block .left-bar']?>"><?php echo $nbAttendances.'/'.$nbCourses?></td>
					<td class="left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].$style['.profile-block .left-bar']?>"></td>
				</tr>
			</table>
			
			<br><br><br><br>
			<pagebreak />
			
			<h2 class="paragraph-subtitle" style="<?php echo $style['.paragraph-subtitle']?>">Session results:</h2>
			<table style="<?php echo $style['table']?>">
				<tr>
					<td style="<?php echo $style['td'].$style['.profile-block td']?>width:64%;"></td>
					<td class="profile-value left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.profile-value'].
						$style['.left-bar'].$style['.profile-block .left-bar']?>width:18%;">Assessment</td>
					<td class="profile-value left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.profile-value'].
						$style['.left-bar'].$style['.profile-block .left-bar']?>width:18%;">Time</td>
				</tr>
				<?php
				$totalPercentage = $totalTimeSpent = $nbCourses = $nbAttendances = 0;
				if (!empty($LP['learning_plan_courses'])){
					foreach ($LP['learning_plan_courses'] as $ix=>$LPC){
						if (empty($LPC['course_info']['course_name']) ||
							!in_array(strtolower($LPC['course_info']['course_type']), array('videoconference', 'classroom', 'webinar', 'telephone')))
						{
							continue;
						}
						$nbCourses++;
						if (isset($LPC['course_user_details']['status']) && $LPC['course_user_details']['status']==2) $nbAttendances++;
						$session = !empty($LPC['course_sessions'][0]['session_info']) ? $LPC['course_sessions'][0] : null;
						$criteria_evaluation = null;
						if (!empty($session['user_session_details']['criteria_evalution'])){
							foreach ($session['user_session_details']['criteria_evalution'] as $crit){
								if (!isset($crit['name'])) continue;
								if (!isset($criteria_evaluation[$crit['name']])){
									$criteria_evaluation[$crit['name']] = $crit;
								}
							}
						}?>
				<tr>
					<td class="top-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.top-bar']?>"><?php
						echo '<b>'.$LPC['course_info']['course_name'].'</b>'.($session ? ' - '.date('d.m.Y H:i', strtotime($session['session_info']['date_begin'])) : '');
					?></td>
					<td class="top-bar left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.top-bar'].
						$style['.left-bar-lightgrey'].$style['.profile-block .left-bar']?>"><b><?php
						$score = !empty($session['user_session_details']['evaluation_score']) ? (float)$session['user_session_details']['evaluation_score'] : 0;
						$totalPercentage += $score;
						echo $score ? number_format($score, 2, ',', '.').'%' : '-';
					?></b></td>
					<td class="top-bar left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.top-bar'].
						$style['.left-bar-lightgrey'].$style['.profile-block .left-bar']?>"><b><?php
						//Time spent
						$duration = 0;
						if ($score){
							if (!empty($session['user_session_details']['attendance_hours'])){
								$duration = (float)$session['user_session_details']['attendance_hours']*3600;
								$totalTimeSpent += $duration;
							}
							elseif (!empty($session['session_info']['date_end'])){
								$t_begin	= strtotime($session['session_info']['date_begin']);
								$t_end		= strtotime($session['session_info']['date_end']);
								$duration	= $t_end - $t_begin;
								$totalTimeSpent += $duration;
							}
						}
						echo $duration ? gmdate('H:i', $duration) : ' - ';?></b></td>
				</tr><?php
						if ($criteria_evaluation){?>
				<tr>
					<td style="<?php echo $style['td'].$style['.profile-block td'].$style['.lpadding-20'].
						$style['.top-bar-lightgrey']?>"><i>Objectives</i></td>
					<td style="<?php echo $style['td'].$style['.profile-block td'].
						$style['.left-bar-lightgrey'].$style['.top-bar-lightgrey']?>"></td>
					<td style="<?php echo $style['td'].$style['.profile-block td'].
						$style['.left-bar-lightgrey'].$style['.top-bar-lightgrey']?>"></td>
				</tr><?php
							foreach ($criteria_evaluation as $crit){?>
				<tr>
					<td style="<?php echo $style['td'].$style['.profile-block td'].
						$style['.lpadding-40']//.$style['.top-bar-lightgrey']?>"><?php echo $crit['name']?></td>
					<td style="<?php echo $style['td'].$style['.profile-block td']./*$style['.top-bar-lightgrey'].*/
						$style['.left-bar-lightgrey'].$style['.profile-block .left-bar']?>"><?php echo ' - ';//echo $crit['value'] ? number_format($crit['value'], 2, ',', '.').'%' : ' - ';?></td>
					<td style="<?php echo $style['td'].$style['.profile-block td']./*$style['.top-bar-lightgrey'].*/
						$style['.left-bar-lightgrey'].$style['.profile-block .left-bar']?>"></td>
				</tr>			
							<?php
							}
						}
					}
				}?>
				<tr class="bg-grey" style="<?php echo $style['.bg-grey']?>">
					<td class="table-total-label" style="<?php echo $style['td'].$style['.profile-block td'].$style['.table-total-label']?>"><?php echo _('Total skill sessions average')?></td>
					<td class="profile-value left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].
						$style['.profile-value'].$style['.profile-block .left-bar']?>"><?php if ($nbCourses) echo number_format(($totalPercentage/$nbAttendances), 2, ',', '.').'%';?></td>
					<td class="profile-value left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].
						$style['.profile-value'].$style['.profile-block .left-bar']?>"><?php echo gmdate('H:i', $totalTimeSpent);?></td>
				</tr>
				<tr>
					<td class="table-total-label" style="<?php echo $style['td'].$style['.profile-block td'].$style['.table-total-label']?>"><?php echo _('Attendance')?></td>
					<td class="left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].$style['.profile-block .left-bar']?>"><?php echo $nbAttendances.'/'.$nbCourses?></td>
					<td class="left-bar" style="<?php echo $style['td'].$style['.profile-block td'].$style['.left-bar'].$style['.profile-block .left-bar']?>"></td>
				</tr>
			</table>
		</div>
		
		<br><br>
		
		<h1 class="paragraph-title" style="<?php echo $style['.paragraph-title']?>">
			Evaluator comments
		</h1>
		<div class="profile-block bg-grey" style="<?php echo $style['.profile-block'].$style['.bg-grey']?>">
			<h2 class="paragraph-subtitle" style="<?php echo $style['.paragraph-subtitle']?>">SKILLS:</h2>
			<?php if (!$isRO){?>
			<textarea name="evaluator_comments" id="evaluator_comments" style="<?php echo $style['#evaluator_comments']?>"><?php
			if (!empty($ReportContent['evaluator_comments']['value']))
				echo $ReportContent['evaluator_comments']['value'];
			?></textarea>
			<?php }elseif (!empty($ReportContent['evaluator_comments']['value'])){?>
			<div style="font-size:12px;">
				<?php echo nl2br($ReportContent['evaluator_comments']['value']);?>
			</div>
			<?php }?>
		</div>
		
		<br><br><br>
		<!-- <pagebreak /> -->
		
		<h1 class="paragraph-title" style="<?php echo $style['.paragraph-title']?>">SKILL’S LEVEL</h1>
		<div class="profile-block" style="<?php echo $style['.profile-block']?>">
			<!-- <h2 class="paragraph-subtitle" style="<?php echo $style['.paragraph-subtitle']?>">SKILLS:</h2> -->
			<br>
			<div>Learner's current level for each of the skills below:</div>
			<br>
			<div class="level-scale-container" style="<?php echo $style['.level-scale-container']?>">
				<?php foreach (array(
					'listening_current_level'	=>'Listening:',
					'speaking_current_level'	=>'Speaking:',
					'reading_current_level'		=>'Reading:',
					'spoken_production_current_level'	=>'Spoken production:',
					'spoken_interaction_current_level'	=>'Spoken interaction:',
				) as $key=>$text){?>
				<div class="level-spacing" style="<?php echo $style['.level-spacing']?>">
					<label for="<?php echo $key?>" class="level-label" style="<?php echo $style['.level-label']?>"><?php echo $text?></label>
					<?php if (!$isRO){?>
					<select id="<?php echo $key?>" name="<?php echo $key?>" class="level-scale bg-grey"
						style="<?php echo $style['.level-scale'].$style['.bg-grey']?>">
						<option></option>
						<?php foreach ($levelSelectors as $lK=>$lT){?>
						<option value="<?php echo $lK?>"<?php
							if (!empty($ReportContent[$key]['value']) && $ReportContent[$key]['value']==$lK)
								echo ' selected';
						?>><?php echo $lT?></option>
						<?php }?>
					</select>
					<?php }elseif (!empty($levelSelectors[$ReportContent[$key]['value']])){?>
					&nbsp;
					<span class="profile-value" style="<?php echo $style['.profile-value']?>"><?php
						echo $levelSelectors[$ReportContent[$key]['value']];?></span>
					<?php }?>
				</div>
				<?php }?>
			</div>
		</div>
		
		<br><br>
		
		<h1 class="paragraph-title" style="<?php echo $style['.paragraph-title']?>">LEARNER’S LEVEL</h1>
		<div class="profile-block bg-grey" style="<?php echo $style['.profile-block'].$style['.bg-grey']?>">
			<div>Learner's overall current and recommended levels:</div>
			<div class="level-scale-container" style="<?php echo $style['.level-scale-container']?>">
				<?php foreach (array(
					'acquired_level'	=>'Current level:',
					'recommended_level'	=>'Recommended level:',
				) as $key=>$text){
					$thisLvlSelector = ($key === 'acquired_level') ? $acquiredLevels : $recommendedLevels;?>
				<div class="level-spacing" style="<?php echo $style['.level-spacing']?>">
					<label for="<?php echo $key?>" class="level-label" style="<?php echo $style['.level-label']?>"><?php echo $text?></label>
					<?php if (!$isRO){?>
					<select id="<?php echo $key?>" name="<?php echo $key?>" class="level-scale" style="<?php echo $style['.level-scale']?>">
						<option></option>
						<?php foreach ($thisLvlSelector as $lK=>$lT){?>
						<option value="<?php echo $lK?>"<?php
							if (!empty($ReportContent[$key]['value']) && $ReportContent[$key]['value']==$lK)
								echo ' selected';
						?>><?php echo $lT?></option>
						<?php }?>
					</select>
					<?php }elseif (!empty($thisLvlSelector[$ReportContent[$key]['value']])){?>
					&nbsp;
					<span class="profile-value" style="<?php echo $style['.profile-value']?>"><?php
						echo $thisLvlSelector[$ReportContent[$key]['value']];?></span>
					<?php }?>
				</div>
				<?php }?>
				<div class="level-spacing" style="<?php echo $style['.level-spacing']?>">
					<span class="level-label" style="<?php echo $style['.level-label']?>">PROGRESS:</span>
					&nbsp;
					<label for="progress_satisfactory" class="radio-label" style="<?php echo $style['.radio-label']?>">
						<input type="radio" value="1" id="progress_satisfactory" name="progress_satisfactory"<?php
						if (!empty($ReportContent['progress_satisfactory']) && (int)$ReportContent['progress_satisfactory']===1) echo ' selected';?> />
						&nbsp;
						Satisfactory
					</label>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<label for="progress_unsatisfactory" class="radio-label" style="<?php echo $style['.radio-label']?>">
						<input type="radio" value="0" id="progress_unsatisfactory" name="progress_satisfactory"<?php
						if (!empty($ReportContent['progress_satisfactory']) && (int)$ReportContent['progress_satisfactory']===0) echo ' selected';?> />
						&nbsp;
						Unsatisfactory
					</label>
				</div>
			</div>
		</div>
	</div>
</div>